@startuml VendingMachineV2_Overview
!theme plain
skinparam backgroundColor #F9F9F9
skinparam rectangle {
  BackgroundColor #E8F8E8
  BorderColor #2E8B57
  FontColor #333333
  FontSize 12
  shadowing true
}
skinparam actor {
  BackgroundColor #ADD8E6
  FontColor #000000
  BorderColor #555555
}

title VendingMachine DAO V2 - Vue d'ensemble

' === Utilisateurs ===
actor Alice as A
actor Bob as B
actor Charlie as C

' === Front-end / Interface ===
rectangle "React Front-end" as FE {
  rectangle "MetaMask / Web3 Provider" as MM
  FE --> MM : connect / interact
}

' === Smart Contracts ===
rectangle "VendingMachineV2 Proxy" as VMProxy {
  rectangle "VendingMachineV1 (logic)" as V1
  rectangle "VendingMachineV2 (logic + DAO)" as V2
  rectangle "ProductLibrary" as Lib
  rectangle "GovernanceToken (ERC20Votes)" as Token
  rectangle "VendingGovernor" as Governor
  rectangle "TimelockController" as Timelock
}

' === Relations Utilisateurs -> Contracts ===
A --> FE
B --> FE
C --> FE
MM --> VMProxy : transactions / calls

' === Core flows ===
VMProxy --> Lib : product management
VMProxy --> Token : mintForPurchase
V2 --> Token : controls minting
Governor --> Token : reads votes
Governor --> Timelock : schedule / execute
Timelock --> V2 : execute proposals

' === Sequence / Lifecycle simplified ===
rectangle "Governance Flow" as GF #DCEBDC {
  [Buy product â†’ mint tokens] --> [Delegate votes]
  [Delegate votes] --> [Propose action]
  [Propose action] --> [Vote period]
  [Vote period] --> [Queue in Timelock]
  [Queue in Timelock] --> [Execute proposal]
  [Execute proposal] --> [Update products / revenue]
}

' Connect governance flow to smart contracts
A --> GF
B --> GF
C --> GF
GF --> Governor
GF --> Timelock
GF --> V2

' Notes
note right of VMProxy
  Proxy preserves V1 storage
  Upgradeable via UUPS
end note

note right of Token
  ERC20 + ERC20Votes
  Voting power = token balance
end note

note right of Governor
  Handles proposals, votes, quorum & thresholds
end note

note right of Timelock
  Enforces 2-day delay
  Secure execution of approved proposals
end note

@enduml
